
# SeqOthello

__SeqOthello__ is an ultra-fast and memory-efficient indexing structure to support arbitrary sequence query against large collections of RNA-seq experiments. SeqOthello requires only five minutes to conduct a global survey of 11,658 fusion events against 10,113 TCGA Pan-Cancer RNA-seq datasets on a standard computer with 19.1 GB memory space. The query recovers 92.7% of tier-1 fusions curated by TCGA Fusion Gene Database and further reveals 270 novel fusion occurrences, all of which present as tumor-specific. The entire index is only 76 GB, achieving a 700:1 compression ratio relative to the original sequencing data and making it extremely portable. This is the first sequence search index constructed on the scale of TCGA data. By providing a reference-free, alignment-free, and parameter-free sequence search system, SeqOthello will enable large-scale integrative studies using sequence-level data, an undertaking not previously practicable for many individual labs. SeqOthello is currently available as both a standalone software package and a docker container hosted on Amazon AWS Cloud Service.


## SeqOthello Installation

### Requirements
__SeqOthello__ is tested on linux platforms with the following system settings. The performance is optimized for Intel CPUs with SSE4.2 support.

  * cmake >= 2.8.4
  * gcc >= 4.9.1
  * libz >= 1.2.3

Ubuntu
```
sudo apt install cmake build-essential zlib1g-dev
```
Fedora
```
sudo yum install gcc-c++ cmake zlib-dev
```

Mac OS 10.12. Please install cmake using [brew](https://brew.sh/)
```
brew install cmake
```

### Installation

1. Clone the repository:

    ```
    git clone https://github.com/LiuBioinfo/SeqOthello.git
    ```

1. Build SeqOthello:

    ```
    cd SeqOthello/
    ./compile.sh
    ```

    After successfully build the code, you can find __SeqOthello__ toolchain at ``build/bin/``.

    ```
    ls build/bin
    ```

## Run SeqOthello

### Build SeqOthello
The construction of __SeqOthello__ requires the input of a list of
k-mer files, each of which contains the set of _k_-mers extracted from
reads of the corresponding RNA-Seq experiment.
Currently the k-mer file is generated by applying [Jellyfish](https://github.com/gmarcais/Jellyfish) to fasta/fastq files.

For demonstration purpose, we added ``createToy.sh`` to create a toy set of 186 experiments and all the necessary scripts to build the __SeqOthello__ structure.

1. Create example experiment

    ```
    ./createToy.sh
    tree -d example/
    example
      |-- bin     # folder for binary files
      |-- grp     # folder for group files
      |-- kmer    # kmer files
      `-- out     # SeqOthello structure
    ```

    You will find 3 scripts in the ``example/`` folder. We will use them to
    construct __SeqOthello__.

    ```
    ConvertToBinary.sh
    MakeGroup.sh
    BuildSeqOthello.sh
    ```

1. Make __SeqOthello__ binary kmer files
    ``ConvertToBinary.sh`` will convert _k_-mer files in ``kmer/`` to binary and store them in ``example/bin/``.

    ```
    example/ConvertToBinary.sh
    ls example/bin/
    ```

2. Make __SeqOthello__  group files
    ``MakeGroup.sh`` obtain the _k_-mer occurrence maps within small subsets of experiments, where each group contains approximately 50 samples.

    ```
    example/MakeGroup.sh
    ls example/grp/
    ```

3. Build __SeqOthello__ mapping

    ``BuildSeqOthello.sh`` build __SeqOthello__ mapping between the entire set of _k_-mers and their experiment ids.

    ```
    example/BuildSeqOthello.sh
    ls example/map/
    ```

#### Build SeqOthello in parallel

2 of the steps in __SeqOthello__ construction can be easily paralleled. For example, with GNU Parallel, you can convert _k_-mer files with:

```
cat ConvertToBinary.sh | parallel
```

Then, you can make the group files with:

```
cat MakeGroup.sh | parallel
```

### Transcripts Query

__SeqOthello__ supports Containment and Coverage query modes.

#### Containment Query
Containment Query will ***Description***

```
build/bin/Query --map-folder=example/out/ \
--transcript=example/kmer/test.fa \
--output=example/re_containment \
--qthread=8
```

#### Coverage Query
Coverage Query will ***Description***

```
build/bin/Query --map-folder=example/out/ \
--transcript=example/kmer/test.fa \
--output=example/re_coverage \
--detail \
--qthread=8
```

## SeqOthello Online

Use the following command to start a server on the machine, (e.g., on TCP port 3322). The service will run as a deamon.

```
build/bin/Query \
--map-folder=example/out/ \
--start-server-port 3322
```

In another terminal, run the Client program.
```
build/bin/Client \
--transcript=kmer/test.fa \
--coverage \
--output=example/re_coverage_online \
--port=3333
```



## License
Please refer to LICENSE.TXT.


## Getting help
For questions running __SeqOthello__, please post to [SeqOthello Google Group](https://groups.google.com/forum/#!forum/seqothello)

## Known issues

Usually, on Linux systems, there is a limit on the number of files that can be opened simutaiously. The Build program of SeqOthello may hit such limit. To edit this limit, set ulimit to larger numbers. e.g,
``ulimit -nS 4096``
